---
/**
 * Base Layout - Level Garment
 * Main layout wrapper for all pages
 */
import Header from '../components/layout/Header.astro';
import Footer from '../components/layout/Footer.astro';
import siteConfig from '../data/site-config.json';
import '../styles/global.css';

export interface Props {
  title: string;
  description?: string;
  image?: string;
  noIndex?: boolean;
  type?: 'website' | 'article';
  publishedTime?: string;
  modifiedTime?: string;
  canonicalURL?: string;
}

const {
  title,
  description = siteConfig.description,
  image = '/assets/images/og-image.png',
  noIndex = false,
  type = 'website',
  publishedTime,
  modifiedTime,
  canonicalURL,
} = Astro.props;

// Generate canonical URL
const fullCanonicalURL = canonicalURL
  ? new URL(canonicalURL, siteConfig.siteUrl)
  : new URL(Astro.url.pathname, siteConfig.siteUrl);

// Page type for structured data
const pageType = type === 'article' ? 'article' : 'website';
---

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content={Astro.generator}>

  <!-- SEO Meta Tags -->
  <title>{title} - {siteConfig.siteName}</title>
  <meta name="description" content={description}>
  <link rel="canonical" href={fullCanonicalURL}>

  {noIndex && <meta name="robots" content="noindex, nofollow">}

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content={pageType}>
  <meta property="og:url" content={fullCanonicalURL}>
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:image" content={new URL(image, siteConfig.siteUrl)}>
  <meta property="og:site_name" content={siteConfig.siteName}>
  <meta property="og:locale" content="id_ID">

  {publishedTime && <meta property="article:published_time" content={publishedTime}>}
  {modifiedTime && <meta property="article:modified_time" content={modifiedTime}>}

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content={fullCanonicalURL}>
  <meta name="twitter:title" content={title}>
  <meta name="twitter:description" content={description}>
  <meta name="twitter:image" content={new URL(image, siteConfig.siteUrl)}>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon.png">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700;800&family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Structured Data -->
  <script set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": type === 'article' ? 'Article' : 'WebPage',
    "name": title,
    "description": description,
    "url": fullCanonicalURL,
    "publisher": {
      "@type": "Organization",
      "name": siteConfig.siteName,
      "url": siteConfig.siteUrl,
      "logo": {
        "@type": "ImageObject",
        "url": new URL('/assets/images/logo.png', siteConfig.siteUrl)
      },
      "sameAs": [
        siteConfig.social.instagram,
        siteConfig.social.tiktok
      ]
    },
    ...(type === 'article' && {
      "headline": title,
      "datePublished": publishedTime,
      "dateModified": modifiedTime
    })
  })} type="application/ld+json"></script>
</head>

<body class="min-h-screen flex flex-col">
  <!-- Skip to main content for accessibility -->
  <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary text-white px-4 py-2 rounded-lg z-50">
    Skip to main content
  </a>

  <!-- Header / Navigation -->
  <Header />

  <!-- Main Content -->
  <main id="main-content" class="flex-grow">
    <slot />
  </main>

  <!-- Footer -->
  <Footer />

  <!-- Back to Top Button -->
  <button
    id="back-to-top"
    aria-label="Back to top"
    class="fixed bottom-8 right-8 bg-primary text-white p-3 rounded-full shadow-lg opacity-0 invisible transition-all duration-300 hover:bg-primary-dark z-40"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
    </svg>
  </button>

  <!-- Back to Top Script -->
  <script define:vars={{ threshold: 300 }}>
    const backToTop = document.getElementById('back-to-top');
    let isVisible = false;

    const toggleBackToTop = () => {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

      if (scrollTop > threshold && !isVisible) {
        backToTop.classList.remove('opacity-0', 'invisible');
        backToTop.classList.add('opacity-100', 'visible');
        isVisible = true;
      } else if (scrollTop <= threshold && isVisible) {
        backToTop.classList.add('opacity-0', 'invisible');
        backToTop.classList.remove('opacity-100', 'visible');
        isVisible = false;
      }
    };

    const scrollToTop = () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    window.addEventListener('scroll', toggleBackToTop);
    backToTop.addEventListener('click', scrollToTop);
  </script>
</body>
</html>

<style>
  /* Screen reader only */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  .focus\:not-sr-only:focus {
    position: static;
    width: auto;
    height: auto;
    padding: inherit;
    margin: inherit;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }
</style>
